# Enable HTTPS and www rewrites
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Redirect HTTP to HTTPS (uncomment if needed)
  # RewriteCond %{HTTPS} off
  # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
  
  # Redirect non-www to www (uncomment if needed)
  # RewriteCond %{HTTP_HOST} ^fyt-research\.org$ [NC]
  # RewriteRule ^(.*)$ https://www.fyt-research.org/$1 [L,R=301]
  
  # ========================================
  # TRAILING SLASH NORMALIZATION (SEO CRITICAL)
  # Remove trailing slashes from all URLs except root
  # Prevents duplicate content indexing by search engines
  # ========================================
  
  # Remove trailing slash from URLs (except root /)
  # This ensures /investigacion/ redirects to /investigacion
  RewriteCond %{REQUEST_URI} !^/$
  RewriteCond %{REQUEST_URI} !^/\.well-known/
  RewriteCond %{REQUEST_URI} (.+)/$
  RewriteRule ^ %1 [R=301,L]
  
  # ========================================
  # SPA ROUTING
  # Serve index.html for all non-file/non-directory requests
  # ========================================
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^ index.html [QSA,L]
</IfModule>

# Cache configuration
<FilesMatch "\.(js|css|svg|webp|woff2)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

<FilesMatch "\.html$">
  Header set Cache-Control "public, max-age=0, must-revalidate"
</FilesMatch>

<FilesMatch "^(sw\.js)$">
  Header set Cache-Control "public, max-age=0, must-revalidate"
</FilesMatch>

# Enable gzip compression
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>
